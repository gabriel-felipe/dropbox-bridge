var Dropbox=Vue.component("dropbox",{template:"#dropbox-template",props:{user:{type:Object,default:{}}},data:function(){return{ready:!1,folder:null,files:[],newFileCallbackUrl:null,urlError:"",savingUrl:!1,urlSaved:!1}},created:function(){this.updateFiles()},methods:{saveUrl:function(){if(this.$refs.inputUrl)if(input=this.$refs.inputUrl,this.urlSaved=!1,input.validity.valid){this.urlError="",this.savingUrl=!0;var t=this.newFileCallbackUrl,e={url:apiEndPoint+"url/new-file-callback",method:"POST",params:{callbackUrl:t}};this.$http(e).then(function(t){this.savingUrl=!1,"success"!==t.body.status?this.urlError="Please fill a valid url":this.urlSaved=!0})}else this.urlError="Please fill a valid url"},updateFiles:function(){var t={url:apiEndPoint+"/account",method:"GET"};this.$http(t).then(function(t){var e=this;if(window.setTimeout(function(){e.updateFiles()},5e3),200===t.status)if(t.body.authenticated){var o=t.body.user;this.$emit("found-user",o),t.body.folder?(this.ready=!0,this.folder=t.body.folder,this.files=t.body.files,t.body.newFileCallbackUrl&&!this.newFileCallbackUrl&&(this.newFileCallbackUrl=t.body.newFileCallbackUrl)):this.$router.push("/select-folder")}else this.$router.push("/")})}}}),SelectFolder=Vue.component("selectFolder",{template:"#select-folder-template",props:{user:{type:Object,default:{}}},data:function(){return{selectedFolder:"/",saving:!1}},created:function(){},methods:{setSelected:function(t){this.selectedFolder=t},confirm:function(){if(this.selectedFolder){this.saving=!0;var t=this.selectedFolder,e={url:apiEndPoint+"/folders",method:"POST",params:{folder:t}};this.$http(e).then(function(t){this.foldersLoaded=!0,this.saving=!1,200===t.status&&"success"===t.body.status&&this.$router.push("/dropbox")})}}}}),Login=Vue.component("login",{template:"#login-template",props:{},data:function(){return{ready:!1,loginUrl:null}},created:function(){var t={url:apiEndPoint+"/login-url",method:"GET"};this.$http(t).then(function(t){200===t.status&&(t.body.authenticated?this.$router.push("/dropbox"):(this.ready=!0,this.loginUrl=t.body.url))})},methods:{}});console.log(Login);var Loader=Vue.component("loader",{template:"#loader-template",props:{},data:function(){return{}},methods:{}}),File=Vue.component("file",{template:"#file-template",props:{path:String,id:String},data:function(){return{progress:0,link:null}},created:function(){this.updateProgress()},computed:{},methods:{updateProgress:function(){console.log(this.path);var t=this.id,e={url:apiEndPoint+"/file/status?id="+t,method:"GET"};this.$http(e).then(function(t){if(200===t.status)if("not_found"!==t.body.status)if(this.progress=t.body.progress,this.progress<100){var e=this;window.setTimeout(function(){e.updateProgress()},300)}else this.link=t.body.link;else{e=this;window.setTimeout(function(){e.updateProgress()},300)}})}}}),Folder=Vue.component("folder",{template:"#folder-template",props:{path:String,selectedFolder:String},data:function(){return{showChilds:!1,folders:[],foldersLoaded:!1}},created:function(){this.updateFolders()},computed:{selected:function(){return this.path==this.selectedFolder}},methods:{open:function(){this.showChilds=!0},close:function(){this.showChilds=!1},toggle:function(){this.showChilds?this.close():this.open()},select:function(){this.emitSelected(this.path)},emitSelected:function(t){this.$emit("selected",t)},updateFolders:function(){folder=this.path;var t={url:apiEndPoint+"/folders/list",method:"GET",params:{folder:folder}};this.$http(t).then(function(t){this.foldersLoaded=!0,200===t.status&&(t.body.folders?(this.ready=!0,this.folders=t.body.folders):this.$router.push("/"))})}}}),apiEndPoint="http://localhost/dropbox-integration/api/",routes=[{path:"/",component:Login},{path:"/dropbox",component:Dropbox},{path:"/select-folder",component:SelectFolder}],router=new VueRouter({routes:routes,scrollBehavior:function(t,e,o){return o||{x:0,y:0}}}),app=new Vue({router:router,data:{user:{name:null}},created:function(){var t={url:apiEndPoint+"/account",method:"GET"};this.$http(t).then(function(t){var e=this;if(window.setTimeout(function(){e.updateFiles()},5e3),200===t.status)if(t.body.authenticated){var o=t.body.user;this.updateUser(o)}else this.$router.push("/")})},methods:{updateUser:function(t){console.log(t),console.log("UPDATING USER"),this.user=t}}}).$mount("#app");